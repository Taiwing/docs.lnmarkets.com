## REST

## Authentication

API key authentication requires each request to be signed (enhanced security measure).

You can create and activate new API keys in your API [here](https://lnmarkets.com/user/api).

Your API keys should be assigned to access only accounts and permission scopes that are necessary for your app to function.

## Making a request

All REST requests must contain the following headers:

- **LNM-ACCESS-KEY** API key as a string
- **LNM-ACCESS-SIGN** Message signature
- **LNM-ACCESS-PASSPHRASE** API key passphrase
- **LNM-ACCESS-TIMESTAMP** Timestamp for your request

All request bodies should have content type **application/json** and be valid JSON.

Example :

```shell
curl https://api.lnmarkets.com/v1/user \
  --header "LNM-ACCESS-KEY: <your api key>" \
  --header "LNM-ACCESS-PASSPHRASE: <your api key passphrase>" \
  --header "LNM-ACCESS-SIGN: <the user generated message signature>" \
  --header "LNM-ACCESS-TIMESTAMP: <a timestamp for your request>"
```

The **LNM-ACCESS-SIGN** header is generated by creating a sha256 HMAC using the secret key on the prehash string `timestamp + method + path + params` (where + represents string concatenation).

The `timestamp` value is the same as the LNM-ACCESS-TIMESTAMP header.
The timestamp MUST be number of seconds since Unix Epoch in UTC and it should be within 30seconds of our API time

The `params` is the request body or query parameters stringified with json.

The `method` should be UPPER CASE.

The `path` is the request path of the URL, e.g.: _/v1/user_

Here is an example in javascript

```JS
const https = require('https')
const { createHmac } = require('crypto')
const { URLSearchParams } = require('url')

const requestAPI = (options) => {
  return new Promise((resolve, reject) => {
    const req = https.request(options, (res) => {
      res.setEncoding('utf8')

      let data = ''

      res.on('data', (chunk) => {
        data += chunk
      })

      res.on('error', (error) => {
        reject(error)
      })

      res.on('end', () => {
        if (this.debug) {
          return resolve({ req, res })
        }

        try {
          const body = JSON.parse(data)

          if (res.statusCode === 200) {
            resolve(body)
          } else {
            console.error(body)
            reject(new Error(res.statusCode, body))
          }
        } catch (error) {
          error.data = data
          reject(error)
        }
      })
    })

    req.on('error', (error) => {
      reject(error)
    })

    if (options.method.match(/^(PUT|POST)$/) && options.params) {
      req.write(JSON.stringify(options.params))
    }

    req.end()
  })
}

const main = async () => {
  const key = 'API_KEY'
  const secret = 'API_SECRET'
  const passphrase = 'API_PASSPHRASE'
  const timestamp = Date.now()

  const params = { type: 'm', side: 'b', quantity: 4242 }

  const method = `POST`
  const path = `/v1/futures`

  const payload = `${timestamp}${method}${path}${JSON.stringify(params)}`

  const signature = createHmac('sha256', secret)
    .update(payload)
    .digest('base64')

  const headers = {
    'Content-Type': 'application/json',
    'LNM-ACCESS-KEY': key,
    'LNM-ACCESS-PASSPHRASE': passphrase,
    'LNM-ACCESS-TIMESTAMP': timestamp,
    'LNM-ACCESS-SIGNATURE': signature,
  }

  const options = {
    port: 443,
    hostname: 'api.lnmarkets.com',
    method,
    path,
    headers,
  }

  if (method.match(/^(GET|DELETE)$/) && params) {
    options.path += `?${new URLSearchParams(params).toString()}`
  }

  const position = await requestAPI(options)
  console.log(position)
}

main()

```

If you want a full implementation example you can take a look at our npm package [@ln-markets/api](https://www.npmjs.com/package/@ln-markets/api)
